<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:skia="clr-namespace:SkiaSharp.Views.Maui.Controls;assembly=SkiaSharp.Views.Maui.Controls"
             xmlns:local="clr-namespace:MiniMikuDanceMaui"
             x:Class="MiniMikuDanceMaui.TimelineView"
             Loaded="OnTimelineViewLoaded"
             BackgroundColor="{StaticResource BackgroundColor}">
    <Grid RowDefinitions="Auto,Auto,Auto,*" RowSpacing="4" Padding="4">
        <!-- Operation buttons -->
        <HorizontalStackLayout Grid.Row="0" Spacing="6" HorizontalOptions="Start">
            <Picker x:Name="BoneSelectPicker"
                    WidthRequest="120"
                    SelectedIndexChanged="OnBoneSelectChanged" />
            <Button Text="Add Key"    Clicked="OnAddKeyClicked" />
            <Button Text="Edit Key"   Clicked="OnEditKeyClicked" />
            <Button Text="Delete Key" Clicked="OnDeleteKeyClicked" />
        </HorizontalStackLayout>

        <!-- Playback and Frame controls -->
        <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto">
            <HorizontalStackLayout Grid.Column="0" Spacing="6">
                <Button Text="▶" Clicked="OnPlayClicked" />
                <Button Text="❚❚" Clicked="OnPauseClicked" />
                <Button Text="■" Clicked="OnStopClicked" />
            </HorizontalStackLayout>

            <HorizontalStackLayout Grid.Column="2" Spacing="6">
                <Button Text="|&lt;" Clicked="OnFrameToStartClicked" />
                <Button Text="&lt;"  Clicked="OnFrameMinusOneClicked" />
                <Picker x:Name="CurrentFramePicker" WidthRequest="60" SelectedIndexChanged="OnCurrentFrameChanged" />
                <Button Text=">"  Clicked="OnFramePlusOneClicked" />
                <Button Text=">|" Clicked="OnFrameToEndClicked" />
            </HorizontalStackLayout>
        </Grid>

        <!-- Frame number header -->
        <Grid Grid.Row="2" ColumnDefinitions="Auto,Auto" BackgroundColor="#282828">
            <BoxView Grid.Column="0"
                     WidthRequest="{x:Static local:TimelineView.LeftPanelWidth}"
                     BackgroundColor="#282828" />
            <skia:SKCanvasView x:Name="HeaderCanvas"
                               Grid.Column="1"
                               HeightRequest="{x:Static local:TimelineView.RowHeight}"
                               WidthRequest="{Binding TimelinePixelWidth}"
                               PaintSurface="OnHeaderPaintSurface" />
        </Grid>

        <!-- Timeline Area -->
        <Grid Grid.Row="3" ColumnDefinitions="Auto,Auto">
            <!-- Left Panel (Bone Names) -->
            <local:RefreshableScrollView x:Name="BoneNameScrollView"
                          Grid.Column="0"
                          WidthRequest="{x:Static local:TimelineView.LeftPanelWidth}"
                          Orientation="Vertical"
                          VerticalScrollBarVisibility="Never"
                          VerticalOptions="FillAndExpand">
                <skia:SKCanvasView x:Name="BoneNameCanvas"
                                   HeightRequest="{Binding TimelinePixelHeight}"
                                   PaintSurface="OnBoneNamePaintSurface"
                                   HorizontalOptions="Start"
                                   VerticalOptions="Start" />
            </local:RefreshableScrollView>

            <!-- Right Panel (Timeline Grid) -->
            <local:RefreshableScrollView x:Name="TimelineContentScrollView"
                          Grid.Column="1"
                          Orientation="Vertical"
                          VerticalScrollBarVisibility="Always"
                          HorizontalScrollBarVisibility="Never"
                          VerticalOptions="FillAndExpand">
                <skia:SKCanvasView x:Name="TimelineContentCanvas"
                                   WidthRequest="{Binding TimelinePixelWidth}"
                                   HeightRequest="{Binding TimelinePixelHeight}"
                                   PaintSurface="OnTimelineContentPaintSurface"
                                   VerticalOptions="Start" />
            </local:RefreshableScrollView>
        </Grid>
    </Grid>
</ContentView>
